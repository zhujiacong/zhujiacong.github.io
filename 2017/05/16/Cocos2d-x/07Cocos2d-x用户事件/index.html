<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Cocos2d-x," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="用户事件在Cocos2d-x中，用户事件可以分为：  触摸事件 鼠标事件 键盘输入事件 传感器事件（加速计事件）">
<meta name="keywords" content="Cocos2d-x">
<meta property="og:type" content="article">
<meta property="og:title" content="Cocos2d-x 用户事件">
<meta property="og:url" content="http://yoursite.com/2017/05/16/Cocos2d-x/07Cocos2d-x用户事件/index.html">
<meta property="og:site_name" content="朱家聪的博客">
<meta property="og:description" content="用户事件在Cocos2d-x中，用户事件可以分为：  触摸事件 鼠标事件 键盘输入事件 传感器事件（加速计事件）">
<meta property="og:image" content="http://op3ueeezt.bkt.clouddn.com/EventClass.png">
<meta property="og:image" content="http://op3ueeezt.bkt.clouddn.com/EventListenerClass.png">
<meta property="og:image" content="http://op3ueeezt.bkt.clouddn.com/openGL&UI.png">
<meta property="og:image" content="http://op3ueeezt.bkt.clouddn.com/threeBox.png">
<meta property="og:updated_time" content="2017-09-09T02:07:10.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Cocos2d-x 用户事件">
<meta name="twitter:description" content="用户事件在Cocos2d-x中，用户事件可以分为：  触摸事件 鼠标事件 键盘输入事件 传感器事件（加速计事件）">
<meta name="twitter:image" content="http://op3ueeezt.bkt.clouddn.com/EventClass.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/05/16/Cocos2d-x/07Cocos2d-x用户事件/"/>





  <title> Cocos2d-x 用户事件 | 朱家聪的博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">朱家聪的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/05/16/Cocos2d-x/07Cocos2d-x用户事件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="朱家聪">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="朱家聪的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Cocos2d-x 用户事件
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-16T19:53:45+08:00">
                2017-05-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="用户事件"><a href="#用户事件" class="headerlink" title="用户事件"></a>用户事件</h1><p>在Cocos2d-x中，用户事件可以分为：</p>
<ol>
<li>触摸事件</li>
<li>鼠标事件</li>
<li>键盘输入事件</li>
<li>传感器事件（加速计事件）</li>
</ol>
<a id="more"></a>
<p>Cocos2d-x引擎具有跨平台的特点，所以在不同的平台中对于这些事件的支持都不同：</p>
<pre><code>iOS：触摸事件，加速计事件
Android &amp; Windows Phone： 触摸事件，加速计事件，键盘事件
PC &amp; macOS：鼠标事件，键盘事件
</code></pre><h2 id="事件处理机制"><a href="#事件处理机制" class="headerlink" title="事件处理机制"></a>事件处理机制</h2><p>在Cocos2d-x的一个完整的事件触发和响应机制中，有三个需要我们理解的重要角色，事件、事件源和事件处理者。事件指的是用户事件本身；事件源是事件发生的场所，通常是各个图层或者精灵对象；事件处理者指的是接受事件并对其进行处理的操作或行为。</p>
<h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><p>事件类是Event，它的子类有：</p>
<ol>
<li>EventMouse           鼠标事件</li>
<li>EventTouch           触摸事件</li>
<li>EventAcceleration    加速器事件</li>
<li>EventKeyboard        键盘事件</li>
<li>EventCustom          自定义事件</li>
</ol>
<p>而EventCustom下还有一个子类PhysicsContact（物理引擎中的接触事件）。<br><img src="http://op3ueeezt.bkt.clouddn.com/EventClass.png" alt="EventClass"></p>
<h3 id="事件源"><a href="#事件源" class="headerlink" title="事件源"></a>事件源</h3><p>事件源指的是在Cocos2d-x中的精灵、层、菜单、节点等能够触发事件的对象。</p>
<h3 id="事件处理者"><a href="#事件处理者" class="headerlink" title="事件处理者"></a>事件处理者</h3><p>在Cocos2d-x中，事件处理者指的是事件监听类EventListener。其下有子类：</p>
<ol>
<li>EventListenerMouse 鼠标事件监听器</li>
<li>EventListenerFocus 焦点事件监听器</li>
<li>EventListenerTouchAllAtOnce 多点触摸事件监听器</li>
<li>EventListenerTouchOneByOne 单点触摸事件监听器</li>
<li>EventListenerController 游戏手柄事件监听器</li>
<li>EventListenerKeyboard 键盘事件监听器</li>
<li>EventListenerAcceleration 加速计事件监听器</li>
<li>EventListenerCustom 自定义事件监听器<br>而在自定义事件监听器中还有一个子类，物理引擎接触事件监听器EventListenerPhysicsContact。</li>
</ol>
<p><img src="http://op3ueeezt.bkt.clouddn.com/EventListenerClass.png" alt="EventListenerClass"></p>
<h2 id="事件分发器"><a href="#事件分发器" class="headerlink" title="事件分发器"></a>事件分发器</h2><p>在事件的触发、监听、处理过程中，每一种监听器和对应的事件类型都是一一对应的。在实际运行过程中，例如一个键盘事件，需要和相应的键盘事件监听器建立连结关系，这一操作被称为“注册监听器”。此处就需要使用到事件分发器（EventDispatcher）来负责管理这种关系，事件分发器负责注册监听器，注销监听器和事件分发。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//获取单例的事件分发器对象</span></div><div class="line">EventDispatcher *dispatcher = Director::getInstance()-&gt;getEventDispatcher();</div><div class="line"></div><div class="line"><span class="comment">//注册事件监听器</span></div><div class="line"><span class="comment">//使用优先级来注册事件监听器，不同的数字参数代表不同的优先级，数字越小优先级越高</span></div><div class="line">dispatcher-&gt;addEventListenerWithFixedPriority(cocos2d::EventListener *listener, <span class="keyword">int</span> fixedPriority);</div><div class="line"><span class="comment">//使用精灵的显示优先级来作为事件监听器的优先级，并注册事件监听器</span></div><div class="line"><span class="comment">//精灵的显示优先级指的是精灵在屏幕中显示的上下层次，优先级越高的精灵显示在越上层</span></div><div class="line">dispatcher-&gt;addEventListenerWithSceneGraphPriority(cocos2d::EventListener *listener, cocos2d::Node *node);</div><div class="line"></div><div class="line"><span class="comment">//注销事件监听器</span></div><div class="line"><span class="comment">//注销指定的事件监听器</span></div><div class="line">dispatcher-&gt;removeEventListener(cocos2d::EventListener *listener);</div><div class="line"><span class="comment">//注销自定义的事件监听器</span></div><div class="line">dispatcher-&gt;removeCustomEventListeners(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span> &amp;customEventName);</div><div class="line"><span class="comment">//注销全部的事件监听器</span></div><div class="line">dispatcher-&gt;removeAllEventListeners();</div></pre></td></tr></table></figure>
<h2 id="触摸事件"><a href="#触摸事件" class="headerlink" title="触摸事件"></a>触摸事件</h2><p>触摸事件是在移动端中最常见的一种事件，触摸事件所对应的监听器有EventListenerTouchAllOnce和EventListenerTouchOneByOne。一个触摸事件发生的过程可以从时间和空间两个方面来讨论。</p>
<h3 id="从时间上来看"><a href="#从时间上来看" class="headerlink" title="从时间上来看"></a>从时间上来看</h3><p>一个完整触摸事件可以理解为是从手指接触屏幕的时候开始，然后手指在屏幕中移动直到手指从屏幕上松开。所以触摸事件有onBegan、onMoved、onEnded三个阶段。以及当出现意外情况（例如电话呼入，手机闹钟等）时造成的触摸事件被强制取消onCancelled。单击触摸事件一共有以上四种状态，可以通过回调函数的形式对这些状态进行分别的监听。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//获取单例的事件分发器对象</span></div><div class="line">EventDispatcher *dispatcher = Director::getInstance()-&gt;getEventDispatcher();</div><div class="line"><span class="comment">//创建多点触摸监听器</span></div><div class="line"><span class="keyword">auto</span> *listener = EventListenerTouchAllAtOnce::create();</div><div class="line"><span class="comment">//设置监听器的触发事件</span></div><div class="line">listener-&gt;onTouchesBegan = CC_CALLBACK_2(HelloWorld::touchTouchesBeganCallback, <span class="keyword">this</span>);</div><div class="line">listener-&gt;onTouchesMoved = CC_CALLBACK_2(HelloWorld::touchTouchesMovedCallback, <span class="keyword">this</span>);</div><div class="line">listener-&gt;onTouchesEnded = CC_CALLBACK_2(HelloWorld::touchTouchesEndedCallback, <span class="keyword">this</span>);</div><div class="line">listener-&gt;onTouchesCancelled = CC_CALLBACK_2(HelloWorld::touchTouchesCancelledCallback, <span class="keyword">this</span>);</div><div class="line"><span class="comment">//注册监听器到事件分发器中</span></div><div class="line">dispatcher-&gt;addEventListenerWithFixedPriority(listener, <span class="number">1</span>);</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//触摸事件响应函数</span></div><div class="line"><span class="comment">//两个参数分别为触摸点对象和事件对象</span></div><div class="line"><span class="comment">//因为在多点触摸中可能存在多点触控所以是以数组的形式传入的touches</span></div><div class="line"><span class="keyword">void</span> HelloWorld::touchTouchesBeganCallback(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Touch*&gt;&amp;touches, cocos2d::Event *event)&#123;</div><div class="line">    <span class="built_in">log</span>(<span class="string">"触摸开始"</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> HelloWorld::touchTouchesMovedCallback(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cocos2d::Touch *&gt; &amp;touches, cocos2d::Event *event)&#123;</div><div class="line">    <span class="built_in">log</span>(<span class="string">"手指移动"</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> HelloWorld::touchTouchesEndedCallback(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cocos2d::Touch *&gt; &amp;touches, cocos2d::Event *event)&#123;</div><div class="line">    <span class="built_in">log</span>(<span class="string">"触摸结束"</span>);</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> HelloWorld::touchTouchesCancelledCallback(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cocos2d::Touch *&gt; &amp;touches, cocos2d::Event *event)&#123;</div><div class="line">    <span class="built_in">log</span>(<span class="string">"触摸取消"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="从空间上看"><a href="#从空间上看" class="headerlink" title="从空间上看"></a>从空间上看</h3><p>从空间上来分析，一个触摸事件最主要的就是触摸点在屏幕中的位置。在一次触摸的响应函数中，我们可以从touches中获取当前的触摸点和其坐标位置。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">void</span> HelloWorld::touchTouchesBeganCallback(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Touch*&gt;&amp;touches, cocos2d::Event *event)&#123;</div><div class="line">    <span class="comment">//在Cocos2d-x 3.15版本中，对于单指触摸和多指触摸的响应函数进行了统一，所以单指触摸事件的响应函数中的参数也是一个触摸对象的数组，并且这些处理函数的返回值都设定成了void</span></div><div class="line">    <span class="comment">//对数组进行遍历来获取单个触摸对象</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;item : touches)&#123;</div><div class="line">        <span class="comment">//获取一个触摸对象</span></div><div class="line">        <span class="keyword">auto</span> touch = item;</div><div class="line">        <span class="comment">//在OpenGL坐标系中的坐标点</span></div><div class="line">        <span class="keyword">auto</span> location = touch-&gt;getLocation();</div><div class="line">        <span class="built_in">log</span>(<span class="string">"触摸位置：x=%f,y=%f"</span>, location.x, location.y);</div><div class="line">        <span class="comment">//在UI坐标系中的位置</span></div><div class="line">        <span class="keyword">auto</span> locationInView = touch-&gt;getLocationInView();</div><div class="line">        <span class="built_in">log</span>(<span class="string">"触摸在UI坐标系中的位置：x=%f,y=%f"</span>, locationInView.x, locationInView.y);</div><div class="line">        <span class="comment">//前一次触摸事件的坐标点，用于计算手指移动方向</span></div><div class="line">        <span class="keyword">auto</span> prevLocation = touch-&gt;getPreviousLocation();</div><div class="line">        <span class="keyword">auto</span> prevLocationInView = touch-&gt;getPreviousLocationInView();</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">log</span>(<span class="string">"触摸开始"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>对于OpenGL坐标系和UI坐标系的区别可以用下图来进行理解，蓝色区域表示当前游戏场景，绿色区域表示屏幕实际显示的范围。OpenGL坐标系是以当前场景的左下角作为原点来计算的（红色标记），而UI坐标系是以当前场景的左上角来作为坐标系原点的（蓝色标记）。虽然两种坐标系获取的数值不同，但是我们可以根据开发中的实际需求来获取我们所需要的一个数据。从图中也可以得出屏幕的左下角点坐标并不是（0，0）。可以通过<code>Vec2 origin = Director::getInstance()-&gt;getVisibleOrigin();</code>来获取屏幕原点坐标。</p>
<p><img src="http://op3ueeezt.bkt.clouddn.com/openGL&amp;UI.png" alt="openGL_UI"></p>
<h3 id="案例分析：单点触摸"><a href="#案例分析：单点触摸" class="headerlink" title="案例分析：单点触摸"></a>案例分析：单点触摸</h3><h4 id="游戏场景搭建"><a href="#游戏场景搭建" class="headerlink" title="游戏场景搭建"></a>游戏场景搭建</h4><p>首先构建一个游戏场景。在场景素材中，背景的图片素材是一个128 X 128的png图片，作为背景使用时需要对图片进行平铺处理，所以要设置背景的纹理显示参数为重复。这里用到了OpenGL中对纹理处理的一个纹理参数<code>Texture2D::TexParams</code>。</p>
<pre><code>TexParams是纹理参数，可以通过它实现纹理变换，前两个参数是纹理过滤规则，后两个参数是纹理环绕模式。  
常见的几种：  

* 过滤规则  
    * GL_LINEAR:使用邻近像素点来插值补点  
    * GL_NEAREST:最邻近点过滤  
* 环绕模式  
    * GL_REPEAT：重复纹理  
    * GL_CLAMP：边缘像素复制       
注意纹理的长宽必须是2的n次方，否则会报错   
</code></pre><p><em>在我的示例代码中，GL_CLAMP不能正常使用，提示错误为：未定义的标识符“GL_CLAMP”</em><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//背景层</span></div><div class="line">Sprite *bg = Sprite::create(<span class="string">"BackgroundTile.png"</span>, Rect(<span class="number">0</span>, <span class="number">0</span>, visibleSize.width, visibleSize.height));</div><div class="line"><span class="comment">//设置背景层的纹理显示参数</span></div><div class="line">Texture2D::TexParams params = &#123;GL_LINEAR, GL_LINEAR, GL_REPEAT, GL_REPEAT&#125;;</div><div class="line">bg-&gt;getTexture()-&gt;setTexParameters(params);</div><div class="line">bg-&gt;setPosition(visibleCenter);</div><div class="line"><span class="keyword">this</span>-&gt;addChild(bg, <span class="number">0</span>);</div><div class="line"></div><div class="line"><span class="comment">//精灵对象</span></div><div class="line">Sprite *boxA = Sprite::create(<span class="string">"BoxA2.png"</span>);</div><div class="line">boxA-&gt;setPosition(visibleCenter + Vec2(<span class="number">-50</span>,<span class="number">50</span>));</div><div class="line">boxA-&gt;setContentSize(Size(<span class="number">100</span>,<span class="number">100</span>));</div><div class="line"><span class="keyword">this</span>-&gt;addChild(boxA, <span class="number">10</span>, kBoxATag);</div><div class="line"></div><div class="line">Sprite *boxB = Sprite::create(<span class="string">"BoxB2.png"</span>);</div><div class="line">boxB-&gt;setPosition(visibleCenter);</div><div class="line">boxB-&gt;setContentSize(Size(<span class="number">100</span>,<span class="number">100</span>));</div><div class="line"><span class="keyword">this</span>-&gt;addChild(boxB, <span class="number">20</span>, kBoxBTag);</div><div class="line"></div><div class="line">Sprite *boxC = Sprite::create(<span class="string">"BoxC2.png"</span>);</div><div class="line">boxC-&gt;setPosition(visibleCenter + Vec2(<span class="number">60</span>, <span class="number">60</span>));</div><div class="line">boxC-&gt;setContentSize(Size(<span class="number">100</span>,<span class="number">100</span>));</div><div class="line"><span class="keyword">this</span>-&gt;addChild(boxC, <span class="number">30</span>, kBoxCTag);</div></pre></td></tr></table></figure></p>
<p><img src="http://op3ueeezt.bkt.clouddn.com/threeBox.png" alt="threeBox"></p>
<h4 id="触摸事件监听器注册"><a href="#触摸事件监听器注册" class="headerlink" title="触摸事件监听器注册"></a>触摸事件监听器注册</h4><p>一般来说，我们会在一个场景的onEnter中注册相关事件的监听器。而在onExit函数中移除这些监听器。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> HelloWorld::onEnter()&#123;</div><div class="line">    Scene::onEnter();</div><div class="line">    </div><div class="line">    <span class="comment">//创建单点触摸监听器</span></div><div class="line">    <span class="comment">//设置监听器的事件吞没为true，这样当一个onBegan函数中返回true时，事件就不会传递给下一个监听器</span></div><div class="line">    <span class="keyword">auto</span> listener = EventListenerTouchOneByOne::create();</div><div class="line">    listener-&gt;setSwallowTouches(<span class="literal">true</span>);</div><div class="line">    listener-&gt;onTouchBegan = CC_CALLBACK_2(HelloWorld::touchTouchBeganCallback, <span class="keyword">this</span>);</div><div class="line">    listener-&gt;onTouchMoved = CC_CALLBACK_2(HelloWorld::touchTouchMovedCallback, <span class="keyword">this</span>);</div><div class="line">    listener-&gt;onTouchEnded = CC_CALLBACK_2(HelloWorld::touchTouchEndedCallback, <span class="keyword">this</span>);</div><div class="line">    listener-&gt;onTouchCancelled = CC_CALLBACK_2(HelloWorld::touchTouchCancelledCallback, <span class="keyword">this</span>);</div><div class="line">    </div><div class="line">    <span class="comment">//获取事件分发器</span></div><div class="line">    <span class="keyword">auto</span> dispatcher = Director::getInstance()-&gt;getEventDispatcher();</div><div class="line">    <span class="comment">//注册事件</span></div><div class="line">    <span class="comment">//使用精灵对象的优先级来设置监听器的优先级，这里使用getChildByTag()来获取场景中某个精灵对象</span></div><div class="line">    dispatcher-&gt;addEventListenerWithSceneGraphPriority(listener, getChildByTag(kBoxATag));</div><div class="line">    <span class="comment">//一个监听器只能被注册一次，所以在注册第二个时需要对原本的监听器进行克隆</span></div><div class="line">    dispatcher-&gt;addEventListenerWithSceneGraphPriority(listener-&gt;clone(), getChildByTag(kBoxBTag));</div><div class="line">    dispatcher-&gt;addEventListenerWithSceneGraphPriority(listener-&gt;clone(), getChildByTag(kBoxCTag));</div><div class="line">    </div><div class="line">    </div><div class="line">    </div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span> HelloWorld::onExit()&#123;</div><div class="line">    Scene::onExit();</div><div class="line">    <span class="comment">//移除所有监听器</span></div><div class="line">    Director::getInstance()-&gt;getEventDispatcher()-&gt;removeAllEventListeners();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="事件的处理"><a href="#事件的处理" class="headerlink" title="事件的处理"></a>事件的处理</h4><p>通过onBegan、onMoved和onEnded可以实现一个精灵拖拽的效果。实现思路可以简单概括为，触摸开始时判断触摸到的精灵对象，将这个精灵对象做一个放大动作表示选中。手指移动时移动这个精灵，实现一个跟随移动的效果。触摸结束时将这个精灵还原为原本大小。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">bool</span> HelloWorld::touchTouchBeganCallback(cocos2d::Touch *touch, cocos2d::Event*event)&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//获取事件中所绑定的精灵对象</span></div><div class="line">    Sprite *target = (Sprite *)event-&gt;getCurrentTarget();</div><div class="line">    <span class="comment">//将触摸点的坐标，转化为精灵内部坐标系中的坐标值</span></div><div class="line">    Vec2 locationInNode = target-&gt;convertTouchToNodeSpace(touch);</div><div class="line">    <span class="comment">//获取精灵当前的大小和范围</span></div><div class="line">    Size targetSize = target-&gt;getContentSize();</div><div class="line">    Rect rect = Rect(Vec2::ZERO, targetSize);</div><div class="line">    </div><div class="line">    <span class="comment">//判断触摸点是否在当前精灵节点内</span></div><div class="line">    <span class="keyword">if</span> (rect.containsPoint(locationInNode)) &#123;</div><div class="line">        <span class="built_in">log</span>(<span class="string">"触摸点位置：x=%f,y=%f"</span>, locationInNode.x,locationInNode.y);</div><div class="line">        <span class="built_in">log</span>(<span class="string">"target tag = %i"</span>,target-&gt;getTag());</div><div class="line">        <span class="comment">//放大动作</span></div><div class="line">        <span class="keyword">auto</span> *ac = ScaleTo::create(<span class="number">0.1</span>, <span class="number">1.3</span>);</div><div class="line">        <span class="comment">//将被触摸的对象进行放大</span></div><div class="line">        target-&gt;runAction(ac);</div><div class="line">        <span class="comment">//返回true 吞没这个事件防止后面的精灵再次触发</span></div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//不吞没事件，让后续的精灵来尝试触发</span></div><div class="line">    <span class="comment">//如果在onBegan中返回了false的话，则后续的Moved和Ended都不会再触发</span></div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> HelloWorld::touchTouchMovedCallback(cocos2d::Touch *touch, cocos2d::Event*event)&#123;</div><div class="line">    <span class="comment">//获取事件中所绑定的精灵对象</span></div><div class="line">    Sprite *target = (Sprite *)event-&gt;getCurrentTarget();</div><div class="line">    <span class="comment">//跟随移动效果</span></div><div class="line">    target-&gt;setPosition(target-&gt;getPosition() + touch-&gt;getDelta());    </div><div class="line">&#125;</div><div class="line"><span class="keyword">void</span> HelloWorld::touchTouchEndedCallback(cocos2d::Touch *touch, cocos2d::Event*event)&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//获取事件中所绑定的精灵对象</span></div><div class="line">    Sprite *target = (Sprite *)event-&gt;getCurrentTarget();</div><div class="line">    <span class="comment">//将触摸点的坐标，转化为精灵内部坐标系中的坐标值</span></div><div class="line">    Vec2 locationInNode = target-&gt;convertTouchToNodeSpace(touch);</div><div class="line">    <span class="comment">//获取精灵当前的大小和范围</span></div><div class="line">    Size targetSize = target-&gt;getContentSize();</div><div class="line">    Rect rect = Rect(Vec2::ZERO, targetSize);</div><div class="line">    </div><div class="line">    <span class="comment">//判断触摸点是否在当前精灵节点内</span></div><div class="line">    <span class="keyword">if</span> (rect.containsPoint(locationInNode)) &#123;</div><div class="line">        <span class="built_in">log</span>(<span class="string">"触摸点位置：x=%f,y=%f"</span>, locationInNode.x,locationInNode.y);</div><div class="line">        <span class="built_in">log</span>(<span class="string">"target tag = %i"</span>,target-&gt;getTag());</div><div class="line">        <span class="comment">//还原原本大小</span></div><div class="line">        <span class="keyword">auto</span> *ac = ScaleTo::create(<span class="number">0.1</span>, <span class="number">1</span>);</div><div class="line">        <span class="comment">//将被触摸的对象进行放大</span></div><div class="line">        target-&gt;runAction(ac);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>由这个案例可以大致的推测Cocos2d-x中触摸事件的分发逻辑如下：</p>
<ol>
<li>事件分发器接收到手机屏幕传来的触摸事件后，按照优先级依次触发触摸事件的监听器。</li>
<li>优先级高的监听器（对应的精灵优先级高）先获取到这个触摸事件。</li>
<li>判断触摸点是否在监听器所对应的精灵中，如果在则吞没这个事件防止低优先级的监听器获取这个事件，如果不在精灵中则传递给下一个监听器。这一过程可以被称为事件拦截。</li>
<li>拦截到触摸事件的监听器可以对这个事件进行处理，来改变相对应的精灵对象的位置或者大小。</li>
</ol>
<h3 id="使用Lambda表达式优化代码"><a href="#使用Lambda表达式优化代码" class="headerlink" title="使用Lambda表达式优化代码"></a>使用Lambda表达式优化代码</h3><p>在Cocos2d-x 3.0版本后提供了对C++11标准的支持，使用新标准中的Lambda表达式能够简化以上的代码。Lambda类似于JavaScript中的匿名函数，可以通过Lambda表达式来快速简介的完成触摸事件的响应操作。以onTouchBegan为例，代码可以如下修改。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//源代码</span></div><div class="line">listener-&gt;onTouchBegan = CC_CALLBACK_2(HelloWorld::touchTouchBeganCallback, <span class="keyword">this</span>);</div><div class="line"><span class="comment">//修改为</span></div><div class="line">listener-&gt;onTouchBegan = [](Touch* touch, Event *event)&#123;</div><div class="line">    <span class="comment">//获取事件中所绑定的精灵对象</span></div><div class="line">    Sprite *target = (Sprite *)event-&gt;getCurrentTarget();</div><div class="line">    <span class="comment">//将触摸点的坐标，转化为精灵内部坐标系中的坐标值</span></div><div class="line">    Vec2 locationInNode = target-&gt;convertTouchToNodeSpace(touch);</div><div class="line">    <span class="comment">//获取精灵当前的大小和范围</span></div><div class="line">    Size targetSize = target-&gt;getContentSize();</div><div class="line">    Rect rect = Rect(Vec2::ZERO, targetSize);</div><div class="line">    </div><div class="line">    <span class="comment">//判断触摸点是否在当前精灵节点内</span></div><div class="line">    <span class="keyword">if</span> (rect.containsPoint(locationInNode)) &#123;</div><div class="line">        <span class="built_in">log</span>(<span class="string">"触摸点位置：x=%f,y=%f"</span>, locationInNode.x,locationInNode.y);</div><div class="line">        <span class="built_in">log</span>(<span class="string">"target tag = %i"</span>,target-&gt;getTag());</div><div class="line">        <span class="comment">//放大动作</span></div><div class="line">        <span class="keyword">auto</span> *ac = ScaleTo::create(<span class="number">0.1</span>, <span class="number">1.3</span>);</div><div class="line">        <span class="comment">//将被触摸的对象进行放大</span></div><div class="line">        target-&gt;runAction(ac);</div><div class="line">        <span class="comment">//返回true 吞没这个事件防止后面的精灵再次触发</span></div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//不吞没事件，让后续的精灵来尝试触发</span></div><div class="line">    <span class="comment">//如果在onBegan中返回了false的话，则后续的Moved和Ended都不会再触发</span></div><div class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>在使用Lambda表达式时，需要注意的是匿名函数的参数列表和函数的返回值必须与要求的一致，否则会出现编译错误的现象。巧妙的使用Lambda表达式能够减少当前类中回调函数的使用次数，缩减代码量。</p>
<h2 id="键盘事件"><a href="#键盘事件" class="headerlink" title="键盘事件"></a>键盘事件</h2><p>相对于触摸事件来说，键盘事件明显要简单很多。因为键盘事件没有空间方面的信息，我们只需要关注键盘中按键的按下弹起状态即可。键盘事件监听器不仅可以监听键盘的事件，还能够响应设备的菜单。使用Lambda可以很简单的来监听键盘事件。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//键盘事件监听器</span></div><div class="line"><span class="keyword">auto</span> keyboardListener = EventListenerKeyboard::create();</div><div class="line"><span class="comment">//键盘按键按下事件</span></div><div class="line">keyboardListener-&gt;onKeyPressed = [](EventKeyboard::KeyCode code, Event *event)&#123;</div><div class="line">    <span class="built_in">log</span>(<span class="string">"%d 按钮被按下"</span>, code);</div><div class="line">&#125;;</div><div class="line"><span class="comment">//按键弹起事件</span></div><div class="line">keyboardListener-&gt;onKeyReleased = [](EventKeyboard::KeyCode code, Event *event)&#123;</div><div class="line">    <span class="built_in">log</span>(<span class="string">"%d 按钮被弹起"</span>, code);</div><div class="line">&#125;;</div><div class="line"><span class="comment">//注册键盘事件监听器</span></div><div class="line">dispatcher-&gt;addEventListenerWithSceneGraphPriority(keyboardListener, <span class="keyword">this</span>);</div></pre></td></tr></table></figure>
<h2 id="鼠标事件"><a href="#鼠标事件" class="headerlink" title="鼠标事件"></a>鼠标事件</h2><p>鼠标事件在Cocos2d-x 3.0版本之后添加的，常用在PC平台或者Mac平台中。通过鼠标事件监听器可以监听鼠标的点击、移动、滚轮等操作。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">auto</span> mouseListener = EventListenerMouse::create();</div><div class="line">mouseListener-&gt;onMouseDown = [](Event *event)&#123;</div><div class="line">    <span class="built_in">log</span>(<span class="string">"鼠标被按下"</span>);</div><div class="line">&#125;;</div><div class="line">mouseListener-&gt;onMouseMove = [](Event *event)&#123;</div><div class="line">    <span class="built_in">log</span>(<span class="string">"鼠标正在移动"</span>);</div><div class="line">&#125;;</div><div class="line">mouseListener-&gt;onMouseUp = [](Event *event)&#123;</div><div class="line">    <span class="built_in">log</span>(<span class="string">"鼠标松开"</span>);</div><div class="line">&#125;;</div><div class="line">mouseListener-&gt;onMouseScroll = [](Event *event)&#123;</div><div class="line">    <span class="built_in">log</span>(<span class="string">"鼠标滚轮滑动"</span>);</div><div class="line">&#125;; </div><div class="line"><span class="comment">//注册事件监听器</span></div><div class="line">dispatcher-&gt;addEventListenerWithSceneGraphPriority(mouseListener, <span class="keyword">this</span>);</div></pre></td></tr></table></figure>
<h2 id="层内的事件监控"><a href="#层内的事件监控" class="headerlink" title="层内的事件监控"></a>层内的事件监控</h2><p>除了使用事件监听器进行手动的事件监听之外，还可以在层内部进行事件的监听。首先创建一个子类化的层。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyLayer</span> :</span> <span class="keyword">public</span> cocos2d::Layer</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">init</span><span class="params">()</span></span>;</div><div class="line">    </div><div class="line">    <span class="comment">// implement the "static create()" method manually</span></div><div class="line">    CREATE_FUNC(MyLayer);</div><div class="line">    </div><div class="line">    </div><div class="line">    </div><div class="line">     <span class="comment">//One Touch Event In Layer</span></div><div class="line">     <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">onTouchBegan</span><span class="params">(Touch *touch, Event *event)</span></span>;</div><div class="line">     <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">onTouchCancelled</span><span class="params">(Touch *touch, Event *event)</span></span>;</div><div class="line">     <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">onTouchMoved</span><span class="params">(Touch *touch, Event *event)</span></span>;</div><div class="line">     <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">onTouchEnded</span><span class="params">(Touch *touch, Event *event)</span></span>;</div><div class="line">     </div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">/*</span></div><div class="line">     //Multiple Touch Event In Layer</div><div class="line">     virtual void onTouchesBegan(const std::vector&lt;Touch *&gt; &amp;touches, Event *event);</div><div class="line">     virtual void onTouchesCancelled(const std::vector&lt;Touch *&gt; &amp;touches, Event *event);</div><div class="line">     virtual void onTouchesMoved(const std::vector&lt;Touch *&gt; &amp;touches, Event *event);</div><div class="line">     virtual void onTouchesEnded(const std::vector&lt;Touch *&gt; &amp;touches, Event *event);</div><div class="line">     */</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>然后在cpp文件中实现相关的事件监听。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"MyLayer.h"</span></span></div><div class="line">USING_NS_CC;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">bool</span> MyLayer::init()</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ( !Layer::init() )</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//开启触摸事件</span></div><div class="line">    setTouchEnabled(<span class="literal">true</span>);</div><div class="line">    <span class="comment">//设置触摸类型为单指触摸</span></div><div class="line">    setTouchMode(Touch::DispatchMode::ONE_BY_ONE);</div><div class="line">    <span class="comment">//多指触摸</span></div><div class="line">    <span class="comment">/*setTouchMode(Touch::DispatchMode::ALL_AT_ONCE);*/</span></div><div class="line"></div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"> <span class="meta">#<span class="meta-keyword">pragma</span> mark - Touch Event In Layer</span></div><div class="line"> <span class="keyword">bool</span> MyLayer::onTouchBegan(cocos2d::Touch *touch, cocos2d::Event *event)&#123;</div><div class="line"> </div><div class="line"> <span class="built_in">log</span>(<span class="string">"touch began"</span>);</div><div class="line"> <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line"> &#125;</div><div class="line"> <span class="keyword">void</span> MyLayer::onTouchCancelled(Touch *touch, Event *event)&#123;</div><div class="line"> <span class="built_in">log</span>(<span class="string">"Cancelled"</span>);</div><div class="line"> &#125;</div><div class="line"> <span class="keyword">void</span> MyLayer::onTouchMoved(Touch *touch, Event *event)&#123;</div><div class="line"> <span class="built_in">log</span>(<span class="string">"moved"</span>);</div><div class="line"> &#125;</div><div class="line"> <span class="keyword">void</span> MyLayer::onTouchEnded(Touch *touch, Event *event)&#123;</div><div class="line"> <span class="built_in">log</span>(<span class="string">"ended"</span>);</div><div class="line"> &#125;</div><div class="line"> </div><div class="line"><span class="comment">/*</span></div><div class="line"> #pragma mark - Multiple Touch Event In Layer</div><div class="line"> void MyLayer::onTouchesBegan(const std::vector&lt;Touch *&gt; &amp;touches, Event *event)&#123;</div><div class="line"> log("Multiple touch began");</div><div class="line"> &#125;</div><div class="line"> </div><div class="line"> void MyLayer::onTouchesCancelled(const std::vector&lt;Touch *&gt; &amp;touches, Event *event)&#123;</div><div class="line"> log("Multiple touch Cancelled");</div><div class="line"> &#125;</div><div class="line"> void MyLayer::onTouchesMoved(const std::vector&lt;Touch *&gt; &amp;touches, Event *event)&#123;</div><div class="line"> log("Multiple touch  moved");</div><div class="line"> &#125;</div><div class="line"> void MyLayer::onTouchesEnded(const std::vector&lt;Touch *&gt; &amp;touches, Event *event)&#123;</div><div class="line"> log("Multiple touch  ended");</div><div class="line"> &#125;</div><div class="line"> */</div></pre></td></tr></table></figure>
<h2 id="加速度计事件"><a href="#加速度计事件" class="headerlink" title="加速度计事件"></a>加速度计事件</h2><p>在Cocos2d-x中提供了加速度计事件的相关监听器，通过对手机的加速度计设备的事件处理，我们能够实现更多种类的游戏操控模式。不论是在iPhone还是Android设备中，都是通过一个三轴加速度计来对手机的加速度状态来进行测量的。三轴指的是在三个方向上对加速度分别进行监视，分别是水平从左至右的X轴，竖直从下至上的Y轴以及垂直于手机屏幕，相向用户方向的Z轴。和触摸事件一样，在Cocos2d-x中，加速度计事件也可以由事件分发器和层内加速度计事件来访问加速度计的数据。</p>
<h3 id="使用事件分发器"><a href="#使用事件分发器" class="headerlink" title="使用事件分发器"></a>使用事件分发器</h3><p>对于加速度计事件监听器来说，使用方法和之前所使用的触摸事件监听器有一些略微的不同。首先在使用之前需要开启当前设备的加速度计，然后才能监听加速度计事件。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//启用设备的加速度计</span></div><div class="line">Device::setAccelerometerEnabled(<span class="literal">true</span>);</div><div class="line"><span class="comment">//创建加速度计事件监听器，并且添加事件处理匿名函数</span></div><div class="line"><span class="keyword">auto</span> listener = EventListenerAcceleration::create([](Acceleration *acc, Event *event)&#123;</div><div class="line">    <span class="comment">//获取加速度计数据</span></div><div class="line">    <span class="built_in">log</span>(<span class="string">"onAcceleration:\n\tx = %f\n\ty = %f\n\tz = %f"</span>, acc-&gt;x, acc-&gt;y, acc-&gt;z);</div><div class="line">&#125;);</div><div class="line"><span class="comment">//事件分发器</span></div><div class="line">EventDispatcher *dispatcher = Director::getInstance()-&gt;getEventDispatcher();</div><div class="line">dispatcher-&gt;addEventListenerWithSceneGraphPriority(listener, <span class="keyword">this</span>);</div></pre></td></tr></table></figure>
<h3 id="使用层内事件"><a href="#使用层内事件" class="headerlink" title="使用层内事件"></a>使用层内事件</h3><p>类似于触摸事件，我们也可以在一个层中对加速度计事件进行监听和处理，所使用的方式和触摸事件类似。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccelerationLayer</span> :</span> <span class="keyword">public</span> cocos2d::Layer</div><div class="line">&#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">init</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">onAcceleration</span><span class="params">(cocos2d::Acceleration *acc, cocos2d::Event *event)</span></span>;</div><div class="line">    <span class="comment">// implement the "static create()" method manually</span></div><div class="line">    CREATE_FUNC(AccelerationLayer);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">bool</span> AccelerationLayer::init()</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ( !Layer::init() )</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    Device::setAccelerometerEnabled(<span class="literal">true</span>);</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">void</span> AccelerationLayer::onAcceleration(cocos2d::Acceleration *acc, cocos2d::Event *event)&#123;</div><div class="line">      <span class="built_in">log</span>(<span class="string">"onAcceleration:\n\tx = %f\n\ty = %f\n\tz = %f"</span>, acc-&gt;x, acc-&gt;y, acc-&gt;z);</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Cocos2d-x/" rel="tag"># Cocos2d-x</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/06/01/Cocos2d-x/08Cocos2d-x游戏背景音乐和音效/" rel="next" title="Cocos2d-x游戏背景音乐和音效">
                <i class="fa fa-chevron-left"></i> Cocos2d-x游戏背景音乐和音效
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/05/09/Cocos2d-x/06Cocos2d-x-动作，特效和动画/" rel="prev" title="Cocos2d-x 动作、特效和动画">
                Cocos2d-x 动作、特效和动画 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpeg"
               alt="朱家聪" />
          <p class="site-author-name" itemprop="name">朱家聪</p>
           
              <p class="site-description motion-element" itemprop="description">这里是一个学渣程序员的进步之路，而非技术大牛的心得分享。如在博客中出现技术错误，请各位兄弟联系我并改正：731340034@qq.com</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.zhengyiqun.com/" title="郑逸群小鲜肉的技术分享" target="_blank">郑逸群小鲜肉的技术分享</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#用户事件"><span class="nav-number">1.</span> <span class="nav-text">用户事件</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#事件处理机制"><span class="nav-number">1.1.</span> <span class="nav-text">事件处理机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#事件"><span class="nav-number">1.1.1.</span> <span class="nav-text">事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事件源"><span class="nav-number">1.1.2.</span> <span class="nav-text">事件源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事件处理者"><span class="nav-number">1.1.3.</span> <span class="nav-text">事件处理者</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事件分发器"><span class="nav-number">1.2.</span> <span class="nav-text">事件分发器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#触摸事件"><span class="nav-number">1.3.</span> <span class="nav-text">触摸事件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#从时间上来看"><span class="nav-number">1.3.1.</span> <span class="nav-text">从时间上来看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#从空间上看"><span class="nav-number">1.3.2.</span> <span class="nav-text">从空间上看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#案例分析：单点触摸"><span class="nav-number">1.3.3.</span> <span class="nav-text">案例分析：单点触摸</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#游戏场景搭建"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">游戏场景搭建</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#触摸事件监听器注册"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">触摸事件监听器注册</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#事件的处理"><span class="nav-number">1.3.3.3.</span> <span class="nav-text">事件的处理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用Lambda表达式优化代码"><span class="nav-number">1.3.4.</span> <span class="nav-text">使用Lambda表达式优化代码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#键盘事件"><span class="nav-number">1.4.</span> <span class="nav-text">键盘事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#鼠标事件"><span class="nav-number">1.5.</span> <span class="nav-text">鼠标事件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#层内的事件监控"><span class="nav-number">1.6.</span> <span class="nav-text">层内的事件监控</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#加速度计事件"><span class="nav-number">1.7.</span> <span class="nav-text">加速度计事件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#使用事件分发器"><span class="nav-number">1.7.1.</span> <span class="nav-text">使用事件分发器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用层内事件"><span class="nav-number">1.7.2.</span> <span class="nav-text">使用层内事件</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">朱家聪</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
